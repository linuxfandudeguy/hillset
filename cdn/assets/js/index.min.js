"use strict";const audio=document.getElementById("audio"),playPrompt=document.getElementById("play-prompt"),endMessage=document.getElementById("end-message"),audioContext=new(window.AudioContext||window.webkitAudioContext),analyser=audioContext.createAnalyser();analyser.fftSize=256;const dataArray=new Uint8Array(analyser.frequencyBinCount),source=audioContext.createMediaElementSource(audio);source.connect(analyser),analyser.connect(audioContext.destination);const scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.set(0,50,60),camera.lookAt(0,0,-50);const renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);const hillWidth=100,hillDepth=200,segmentsWidth=50,segmentsDepth=200,geometry=new THREE.PlaneGeometry(100,200,50,200);geometry.rotateX(-Math.PI/2);const material=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0}),hillMesh=new THREE.Mesh(geometry,material);hillMesh.position.z=-50,scene.add(hillMesh);const light=new THREE.DirectionalLight(16777215,1);light.position.set(0,50,50).normalize(),scene.add(light);const simplex=new SimplexNoise;function updateTerrain(e){const t=e.slice(0,10).reduce(((e,t)=>e+t),0)/10/128*1.5;for(let e=0;e<geometry.attributes.position.count;e++){const n=geometry.attributes.position.getX(e),i=geometry.attributes.position.getZ(e)+scrollOffset,o=10*simplex.noise2D(.1*n,.1*i)*t;geometry.attributes.position.setY(e,o)}geometry.attributes.position.needsUpdate=!0}let animationId,scrollOffset=0,mouseX=0,mouseY=0;function animate(){animationId=requestAnimationFrame(animate),analyser.getByteFrequencyData(dataArray),updateTerrain(dataArray),hillMesh.position.z+=.2,scrollOffset+=.2,hillMesh.position.z>=0&&(hillMesh.position.z=-50,scrollOffset=0),camera.position.x=20*mouseX,camera.position.z=scrollOffset-30*mouseY,camera.lookAt(0,0,scrollOffset-10),renderer.render(scene,camera)}playPrompt.addEventListener("click",(()=>{audioContext.resume().then((()=>{audio.play(),playPrompt.style.display="none",animate()}))})),audio.addEventListener("ended",(()=>{cancelAnimationFrame(animationId),endMessage.style.display="block"})),document.addEventListener("mousemove",(e=>{mouseX=e.clientX/window.innerWidth*2-1,mouseY=e.clientY/window.innerHeight*2-1})),window.addEventListener("resize",(()=>{camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}));